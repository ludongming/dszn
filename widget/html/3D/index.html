<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
        <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
        <title>吊顶&墙面搭配方案</title>
        <link rel="stylesheet" href="../../css/weui.min.css">
        <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
        <link rel="stylesheet" href="../../css/dropload.css">
        <link rel="stylesheet" href="../../css/header.css" />
        <style>
            body {
                background-color: white;
                overflow-x: hidden;
                background: #f5f5f5;
            }
            .picbox {
                background: #fff;
                border-color: #f5f5f5;
                width: 100%;
                text-align: center;
                margin-bottom: 10px;
            }
            .picbox img {
                width: 100%;
                height:100%;
                max-height:500px;
            }
            .picname {
                font-size: 15px;
            }
        </style>
    </head>
    <body>
        <header style="position: fixed;" class="page__bd page__bd_spacing">
            <i class="backBtn" ontouchend="goback()" ><img src="../../image/back.png" class="back" /></i><span style="text-align: center;" id="title" class="title">3D全景</span>
         <span    id="showPicker"  style="width:40px; margin-right:10px; float:right;">场景</span>

        </header>
        <div class="page__bd content" id="contents">
            <div class="picarr"></div>
            <div class="fenge"></div>
        </div>
        <script id="interpolationtmpl" type="text/x-dot-template">
            {{~it:value:index}}
            <div class="picbox">
            <a href="javascript:;" onclick="jump('{{=value.subtitle}}')"><img src="../../image/defaultimage.png" data-original="http://www.d-shang.com/{{=value.thumb}}" class="pic"></a>
            <div class="picname" style="">
            {{=value.title}}
            </div>
            </div>
            {{~}}
        </script>
    </body>
    <script type="text/javascript" src="../../script/api.js"></script>
    <script src="../../script/zepto.min.js"></script>
    <script src="../../script/doT.min.js"></script>
    <script src="../../script/weui.min.js"></script>
    <script src="../../script/wolf.js"></script>
    <script type="text/javascript" src="../../script/dropload.min.js"></script>
    <script type="text/javascript" src="../../script/zepto.picLazyLoad.min.js"></script>
    <script type="text/javascript">
        var OPENID;
        var isDrop = false;
        var PAGE = 1;
        var CID = 2209;
        var me;
        apiready = function() {
            setTopBar();
            //setDrop();
            isDrop = true;
            OPENID = api.getPrefs({
                sync : true,
                key : 'openid'
            });
            initPicker();
            loadLastPic();
        }
        function setDrop() {
            $('.content').dropload({
                scrollArea : window,
                autoLoad : true,
                domDown : {
                    domClass : 'dropload-down',
                    domRefresh : '<div class="dropload-refresh">↑上拉加载更多</div>',
                    domLoad : '<div class="dropload-load"><span class="loading"></span>数据加载中</div>',
                    domNoData : '<div class="dropload-noData">没有更多数据</div>'
                },
                loadDownFn : function(mes) {
                    me = mes;
                    phoneGetPic(me);
                    PAGE++;
                },
                threshold : 50
            });
        }

        function initPicker() {
            $('#showPicker').on('click', function() {
                var pickerArr = [{
                    label : '厨房',
                    value : 2207
                }, {
                    label : '卫生间',
                    value : 2208
                }, {
                    label : '餐厅',
                    value : 2209
                }, {
                    label : '客厅',
                    value : 2210
                }, {
                    label : '工装',
                    value : 2211
                }, {
                    label : '活动室',
                    value : 2212
                }, {
                    label : '过道',
                    value : 2213
                }, {
                    label : '书房',
                    value : 2214
                }, {
                    label : '阳台',
                    value : 2215
                }, {
                    label : '卧室',
                    value : 2216
                }];
                weui.picker(pickerArr, {
                    onChange : function(result) {
                        console.log(result);
                    },
                    onConfirm : function(result) {
                        setTitle(pickerArr, result);
                        CID = result;
                        PAGE = 1;
                        $(".picarr").html("");
                        $(".picarr").scrollTop("0");
                        phoneGetPic();
                    }
                });
            });
        }

        //设置标题栏
        function setTitle(pickerArr, cid) {
            for (var i = 0; i < pickerArr.length; i++) {
                if (pickerArr[i].value == cid) {
                    $("#title").html(pickerArr[i].label);
                    return;
                }
            }
        }

        function goback() {
            api.closeWin();
        }

        function jump(url) {
            api.openWin({
                name : "img",
                url : "img.html",
                pageParam : {
                    url : url
                },
                slidBackEnabled : false,
            })
        }

        function loadLastPic(){
          api.ajax({
              url: 'http://www.d-shang.com/index.php?app/getlastquanjing/?openid='+OPENID,
          },function(ret, err){
            var arrText = doT.template($("#interpolationtmpl").text());
            $(".picarr").append(arrText(ret.data));
            $('.pic').picLazyLoad();
          });

        }

        //获取图片
        function phoneGetPic() {
            var url = "http://www.d-shang.com/index.php?app/getnewslist/?cid=" + CID + "&p=" + PAGE + "&openid=" + OPENID
            api.ajax({
                url : url
            }, function(ret, err) {
                var arrText = doT.template($("#interpolationtmpl").text());
                $(".picarr").append(arrText(ret.data));
                $('.pic').picLazyLoad();
            });
        }
    </script>
</html>
