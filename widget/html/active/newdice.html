<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
	<title>title</title>
	<link rel="stylesheet" type="text/css" href="../../css/api.css" />
	<link rel="stylesheet" href="../../css/weui.min.css">
	<link rel="stylesheet" href="../../css/header.css" />
	<style>
		body {
			background: #fff;
		}

		.desk {
			border-top: 6px solid #855124;
			border-bottom: 6px solid #855124;
			background: #075639;
			width: 100%;
			margin: 0 auto;
			height: 420px;
			text-align: center;
			position: relative;
		}
		.kuai {
			border-radius: 10px;
			width: 95%;
			display: flex;
			align-items: center;
			justify-content:  space-between;
			border: 2px solid #649a67;
			flex-wrap: wrap;
			text-align: center;
			margin: 0 auto;
		}

			.box{
				margin:3px;
        border-radius: 5px;
				height:50px;
				line-height: 25px;
				border:1px solid #fff;

			}
			.sz{width:100%;text-align: center;color:#fff;font-size:1.3em;font-weight: 700}
			.bl{color:yellow!important;}
		.titlebtn{
			width: 100%;
text-align: center;
margin: auto;
line-height: 30px;
display: flex;
justify-content: space-between;
align-items: center;

		}
		.titlebtn a{
			color:#000;
			margin: 5px;
			font-size: 1.2em;
			line-height:30px;


		}
		.clear{
			clear: both;
		}
		.detial{
			font-size: 0.7em;
			color: #626262;
		}
		.checked{
			color:#f00 !important;
		}
		.beanall{
			position:absolute;top:0px;  z-index:9; color:#fff;

			font-size:1.1em;
					display: flex;
					align-items: center;
					justify-content:flex-start;
          background-color: #649a67;
          width: 100%;
		}
		.beancount{

		}
		.rank1{
			display: inline-block;
			line-height: 20px;
			margin-left: 10px;
			text-align: center;
			margin-top: 20px;
			float: left;
			width: 25px;
			height: 20px;
			background: #c1c2c6;
			color: #666;
			font-size: 0.9em;
			margin-right: 20px;
		}
		.rank2{
			display: inline-block;
			line-height: 20px;
			margin-left: 10px;
			text-align: center;
			margin-top: 20px;
			float: left;
			width: 25px;
			height: 20px;

			color: #666;
			font-size: 0.7em;
			margin-right: 20px;
		}
		.winning{
			width:60px;
			height:60px;
			border:2px solid #ff9200;
			border-radius:60px;
			position: absolute;
			top:35px;
			right: 0px;
			text-align: center;
			line-height: 60px;
			color:#ff9200; font-style: bold;
font-size: 1.5em;
			z-index: 2;
		}

.big{
width: 47%;
}

.small{
    width: 17%;
}
.middle{
  width: 33%;
}

.shaizi{
	display: flex;
	justify-content: center;
	align-items: center;
}
.shaizi img{
	width:50px;
}

.end{
	color: #fff;
}

	</style>
</head>

<body>
	<header>
		<i class="backBtn" ontouchend="goback()"><img src="../../image/back.png" class="back" /></i><span style="text-align: center;">押宝房</span>
	</header>
	<div class="page__bd content">
		<div id="main">
			<div class="desk">
				<div class="beanall">
					<img src="../../image/chouma.png" style="width:25px; "><div class="beancount"></div>个
        </div>
				<!--<img src="../../image/shaizi.png" style="width:170px; margin-top:30px;">-->
				<div class="kuai" style="margin-top:80px;">
						<div class="box big">
							<span class="sz">4</span>
             <span class="bl">1赔50</span>
					 </div>
           <div class="box big">
   					 <span class="sz">17</span>
   					<span class="bl">1赔50</span>
   				</div>




				 <div class="box small">
						<span class="sz">9</span>
					 <span class="bl">1赔6</span>
				 </div>
				 <div class="box small">
						<span class="sz">10</span>
					 <span class="bl">1赔6</span>
				 </div>
				 <div class="box small">
						<span class="sz">11</span>
					 <span class="bl">1赔6</span>
				 </div>
				 <div class="box small">
						<span class="sz">12</span>
					 <span class="bl">1赔6</span>
				 </div>
         <div class="box small">
           <span class="sz">8</span>
          <span class="bl">1赔8</span>
        </div>
				 <div class="box small">
						<span class="sz">13</span>
					 <span class="bl">1赔8</span>
				 </div>
         <div class="box small">
           <span class="sz">7</span>
          <span class="bl">1赔12</span>
        </div>
				 <div class="box small">
					 <span class="sz">14</span>
					<span class="bl">1赔12</span>
				</div>
        <div class="box small">
          <span class="sz">6</span>
         <span class="bl">1赔14</span>
       </div>
				<div class="box small">
					 <span class="sz">15</span>
					<span class="bl">1赔14</span>
				</div>
        <div class="box big">
         <span class="sz">5</span>
         <span class="bl">1赔18</span>
       </div>
				<div class="box big">
					 <span class="sz">16</span>
					<span class="bl">1赔18</span>
				</div>

<div class="clear"></div>
				</div>

<div class="endshow"></div>

</div>

			</div>







			<div class="explain" style="border-bottom: 1px solid #888;">
				玩法提示：你压30金豆在17，开奖后三个骰子点数相加和正好是17，那么将赔付50倍金豆，你能获得1500金豆<br>
				玩法提示：每10人开奖<br>
				玩法提示：金豆必须要大于50才能玩<br>
			</div>
			<div class="titlebtn" style="margin-top:10px;">
				<a href="javascript:newRank();" class="select checked" onclick="addBorder(this)">本局押注</a>
				<a href="javascript:history();" class="select" onclick="addBorder(this)">中奖结果</a>
					<a href="javascript:selfRank();" class="select" onclick="addBorder(this)">我的押注</a>
				<a href="javascript:winRank();" class="select" onclick="addBorder(this)">土豪榜</a>
				<div class="clear"></div>
			</div>

			<div class="rank" style="width:100%;">
						<div class="weui-cells">
						</div>
			</div>


		</div>
	</div>


</body>

</html>
<script type="text/javascript" id="end">
<div class="end">
	<div class="title">{{=it[0]}}</div>
	<div class="shaizi">
		<img src="../../image/shaizi/{{=it[2].split("")[0]}}.png" alt=""/>
		<img src="../../image/shaizi/{{=it[2].split("")[1]}}.png" alt=""/>
		<img src="../../image/shaizi/{{=it[2].split("")[2]}}.png" alt=""/>
	</div>
</div>
</script>


<script type="text/javascript" id="newrank">
{{~it:value:index}}
<div class="weui-cell">
	<div class="weui-cell__hd">	<span class="rank1">{{=index+1}}</span><img data-original="{{=value.headimgurl}}" alt="" src="../../image/defaulthead.png"  class="pic" style="border-radius:64px; width:64px;"></div>
	<div class="weui-cell__bd"><p>{{=value.real_name}}</p><p style="color:#888;font-size:0.8em;">{{=value.level}}</p></div>
	<img src="../../image/num/{{=value.money}}.png" width="50px" alt=""/>
	<div class="weui-cell__ft">
	{{?value.status=="等待开奖"}}
		<p style="color: orange; font-style: bold;">{{=value.status}}</p>
		{{?}}
		{{?value.status=="中奖"}}
			<p style="color: red; font-style: bold;">{{=value.status}}({{=value.result}})</p>
		{{?value.percent}}
			<div class="winning" style="transform:rotate(-10deg)"><div class="winning_small">{{=value.percent}}倍</div></div>
			{{?}}
			{{?}}

			{{?value.status=="未中奖"}}
				<p style="color: #666; font-style: bold;">{{=value.status}}({{=value.result}})</p>
				{{?}}
		<div class="detial"><p>押{{=value.code}}</p></div>
	</div>
</div>
{{~}}
</script>




<script type="text/javascript" id="history">

{{~it:value:index}}
<div class="weui-cell">
	<div class="weui-cell__hd"><span class="rank2">{{=value.rq}}</span><img data-original="{{=value.headimgurl}}" alt="" src="../../image/defaulthead.png"  class="pic" style="border-radius:64px; width:64px;"></div>
	<div class="weui-cell__bd"><p>{{=value.real_name}}</p><p style="color:#888;font-size:0.8em;">{{=value.level}}</p></div>
	<div class="weui-cell__ft">
	{{?value.status=="等待开奖"}}
		<p style="color: orange; font-style: bold;">{{=value.status}}</p>
		{{?}}
		{{?value.status=="中奖"}}
			<p style="color: red; font-style: bold;">{{=value.status}}({{=value.result}})</p>
	{{?value.percent}}
			<div class="winning" style="transform:rotate(-10deg)"><div class="winning_small">{{=value.percent}}倍</div></div>
			{{?}}
			{{?}}

			{{?value.status=="未中奖"}}
				<p style="color: #666; font-style: bold;">{{=value.status}}({{=value.result}})</p>
				{{?}}
		<div class="detial"><p>{{=value.money}}金豆(押{{=value.code}})</p></div>
	</div>
</div>
{{~}}
</script>

<script type="text/javascript" id="winrank">
{{~it:value:index}}
<div class="weui-cell">
	<div class="weui-cell__hd">
	{{?index<3}} <img src="../../image/rank{{=index+1}}.png" style="width:40px;vertical-align: middle;float:left;margin-right:10px;margin-top:10px;">
		{{??}}
		<span class="rank1">{{=index+1}}</span> {{?}}
	<img data-original="{{=value.headimgurl}}" alt="" src="../../image/defaulthead.png" class="pic" style="border-radius:64px;  width:64px;"></div>
	<div class="weui-cell__bd"><p>{{=value.real_name}}</p><p style="color:#888;font-size:0.8em;">{{=value.level}}</p></div>

<img src="../../image/hanmai.png" onclick="callFriend({{=value.uid}})" style="width:50px; float:left;" alt="" />


	<div class="weui-cell__ft">

		<p style="color: red; font-style: bold;">{{=value.money}}豆</p>
		<div class="detial"></div>
	</div>
</div>
{{~}}
</script>

{{~}}
</script>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/weui.min.js"></script>
<script type="text/javascript" src="../../script/wolf.js"></script>
<script type="text/javascript" src="../../script/zepto.min.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript" src="../../script/swiper-3.3.1.min.js"></script>
<script type="text/javascript" src="../../script/dropload.js"></script>
<script type="text/javascript" src="../../script/wolf.picLazyLoad.min.js"></script>
<script>
	var OPENID;

	apiready = function() {
		setTopBar();
		OPENID = api.getPrefs({
			sync: true,
			key: 'openid'
		});

getDiceRecord();
newRank();
nowbean();
	}

	function confirmScore(code,money) {
		api.confirm({
			title: '买定离手',
			msg: '确认下押'+code+',押'+money+'金豆？',
			buttons: ['确定', '取消']
		}, function(ret, err) {
			var index = ret.buttonIndex;
			if(index==1){
				api.ajax({
					url: 'http://www.d-shang.com/index.php?appdice/addnewtickets/?openid='+OPENID,
					method: "post",
					data: {
						values: {
							openid:OPENID,
							code: code,
							money: money
						}
					}
				}, function(ret) {
				api.toast({msg:ret.message});
				newRank();
				nowbean();
				});
			}
		});
	}


	$(".box").bind("click", function(){
      var code=$(this).children(".sz").text()

	var dialogBox = api.require('dialogBox');
dialogBox.share({
    rect: {
        w: 250,
        h: 150
    },
    items: [{
        text: '押10金豆',
        icon: 'widget://image/num/10.png'
    }, {
        text: '押20金豆',
        icon: 'widget://image/num/20.png'
    }, {
        text: '押30金豆',
        icon: 'widget://image/num/30.png'
    }],
		tapClose:true,
    styles: {
        bg: '#fff',
        column: 3,
        horizontalSpace: 15,
        verticalSpace: 30,
        itemText: {
            color: '#000',
            size: 15,
            marginT: 5
        },
        itemIcon: {
            size: 80
        }
    }
}, function(ret) {
	var bean=ret.index+1;

	if(bean==1){
		 var money=10;
	}else if(bean==2){
	 var	money=20;
	}
	else{
	 var	money=30;
	}
		confirmScore(code,money);
		var dialogBox = api.require('dialogBox');

		dialogBox.close({
	    dialogName: 'share'
	});

});
});


//最新排行
function newRank(){
	var loading = weui.loading("拼命加载中...");
api.ajax({
    url: 'http://www.d-shang.com/index.php?appdice/getlastdice/?openid='+OPENID,
    method: 'post',
}, function(ret, err) {
		loading.hide();
    if (ret) {
					var data=ret.data;
					var newArray=[];
					var historyArray=[];
		for(var i=0;i<data.length;i++){
				data[i].money=parseInt(data[i].money);
				if(data[i].status=="等待开奖"){
					newArray.push(data[i]);
				}
		}
		var arrText = doT.template($("#newrank").text());

		$(".weui-cells").html(arrText(newArray));
	$('.pic').picLazyLoad();
    } else {
        api.alert({ msg: JSON.stringify(err) });
    }
});
}

function history(){
	var loading = weui.loading("拼命加载中...");
api.ajax({
    url: 'http://www.d-shang.com/index.php?appdice/getdicebystatus/?openid='+OPENID,
    method: 'post',
}, function(ret, err) {
		loading.hide();
    if (ret) {
					var data=ret.data;
					var newArray=[];
					var historyArray=[];
		for(var i=0;i<data.length;i++){
				data[i].money=parseInt(data[i].money);
				if(data[i].status!="等待开奖"){
					historyArray.push(data[i]);
				}
		}

		var arrText = doT.template($("#history").text());
		$(".weui-cells").html(arrText(historyArray));
	$('.pic').picLazyLoad();
    } else {
        api.alert({ msg: JSON.stringify(err) });
    }
});
}





function winRank(){
	var loading = weui.loading("拼命加载中...");
	api.ajax({
	    url: 'http://www.d-shang.com/index.php?appdice/getalldicebystatus/?openid='+OPENID,
	    method: 'post',

	}, function(ret, err) {
			loading.hide();
	    if (ret) {
				var data=ret.data;

				var arrText = doT.template($("#winrank").text());
				$(".weui-cells").html(arrText(data));
	$('.pic').picLazyLoad();

	    } else {
	        api.alert({ msg: JSON.stringify(err) });
	    }
	});

}
function selfRank(){
	var loading = weui.loading("拼命加载中...");
	api.ajax({
	    url: 'http://www.d-shang.com/index.php?appdice/getalldicebyuid/?openid='+OPENID,
	    method: 'post',
	}, function(ret, err) {
			loading.hide();
	    if (ret) {
				var data=ret.data;
				for(var i=0;i<data.length;i++){
					data[i].money=parseInt(data[i].money);
				}
				var arrText = doT.template($("#newrank").text());
				$(".weui-cells").html(arrText(data));
				$('.pic').picLazyLoad();

	    } else {
	        api.alert({ msg: JSON.stringify(err) });
	    }
	});
}

function getDiceRecord(){
	var loading = weui.loading("拼命加载中...");
	api.ajax({
	    url: 'http://www.d-shang.com/index.php?appdice/getdicerecord/?openid='+OPENID,
	    method: 'post',
	}, function(ret, err) {
			loading.hide();
	    if (ret) {
			var data=ret.data;
			var arrText = doT.template($("#end").text());
			$(".endshow").html(arrText(data));
			$('.pic').picLazyLoad();

	    } else {
	        api.alert({ msg: JSON.stringify(err) });
	    }
	});
}

function callFriend(uid){
	api.confirm({
		title: '提示',
		msg: '邀请朋友一起玩',
		buttons: ['确定', '取消']
	}, function(ret, err) {
		var index = ret.buttonIndex;
		if(index==1){
			api.ajax({
			    url: 'http://www.d-shang.com/index.php?appdice/callfriend/?openid='+OPENID,
			    method: 'post',
			    data: {
			       values:{
							 openid:OPENID,
							 touid:uid
						 }
			    }
			}, function(ret, err) {
			    if (ret) {
						api.toast({msg:ret.message});
			      nowbean();
			    } else {
			        api.alert({ msg: JSON.stringify(err) });
			    }
			});
		}
	});







}



function addBorder(obj) {

		var a = $(".select");
		$.each(a, function() {
				$(this).removeClass("checked");
		});
		$(obj).addClass("checked");
}
function nowbean(){
	api.ajax({
		url: 'http://www.d-shang.com/index.php?app/getuserinfo/?openid=' + OPENID
	}, function(ret, err) {
		var user = ret.data;
		var  coupons = parseInt(user.coupons);
		$(".beancount").html(coupons);
	});
}
</script>
