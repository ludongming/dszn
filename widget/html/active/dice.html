<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
	<title>title</title>
	<link rel="stylesheet" type="text/css" href="../../css/api.css" />
	<link rel="stylesheet" href="../../css/weui.min.css">
	<link rel="stylesheet" href="../../css/header.css" />
	<style>
		body {
			background: #fff;
		}

		.desk {
			border: 6px solid #855124;
			background: #075639;
			width: 95%;
			margin: 0 auto;
			height: 300px;
			text-align: center;
			position: relative;
		}


		.kuai {
			left: 50px;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 10px;
			width: 80%;
			margin: 0 auto;
			border: 2px solid #649a67;
			height: 120px;
			text-align: center;
		}

		.gezi {
			color: #b4c842;
			width: 49%;
			float: left;
			height: 120px;

			font-size: 2em;
			font-weight: 700;
		}

		.score a {
			color: #fff;
			margin: 2px;
			border: 1px solid #fff;
		}
		.titlebtn{
			width: 100%;
text-align: center;
margin: auto;
line-height: 30px;

		}
		.titlebtn a{
			float: left;
			color:#000;
			margin: 5px;
			font-size: 1.2em;
			line-height:30px;


		}
		.clear{
			clear: both;
		}
		.detial{
			font-size: 0.7em;
			color: #626262;
		}
		.checked{
			color:#f00 !important;
		}
		.beanall{
			position:absolute;top:5px; right:0px; z-index:99; color:#fff; padding:3px 15px 3px 15px;font-size:1.1em;
		}

	</style>
</head>

<body>
	<header>
		<i class="backBtn" ontouchend="goback()"><img src="../../image/back.png" class="back" /></i><span style="text-align: center;">押宝房</span>
	</header>
	<div class="page__bd content">
		<div id="main">
			<div class="desk">
				<div class="beanall" style="">金豆<span class="beancount"></span>个</div>
				<img src="../../image/heguan.png" style="width:150px;">
				<div class="kuai">
					<div class="gezi xiao" style="border-right:2px solid #649a67;">小
						<div class="score"><a href="javascript:confirmScore(1,10);" class="select">10</a><a href="javascript:confirmScore(1,20);" class="select">20</a><a href="javascript:confirmScore(1,30);" class="select">30</a></div>
					</div>
					<div class="gezi da">大
						<div class="score"><a href="javascript:confirmScore(6,10);" class="select">10</a><a href="javascript:confirmScore(6,20);" class="select">20</a><a href="javascript:confirmScore(6,30);" class="select">30</a></div>
					</div>
				</div>

			</div>
			<div class="explain" style="border-bottom: 1px solid #888;">
				1、点击小或者大进行投注。<br>
				2、最大投注为30金豆。<br>
				3、每10人投注自动开奖。<br>
			</div>
			<div class="titlebtn" style="margin-top:10px;">
				<a href="javascript:newRank();" class="select checked" onclick="addBorder(this)">最新押注</a>
					<a href="javascript:selfRank();" class="select " onclick="addBorder(this)">我的押注</a>
				<a href="javascript:winRank();" class="select " onclick="addBorder(this)">赌王</a>

				<div class="clear"></div>
			</div>

			<div class="rank" style="width:100%;">
						<div class="weui-cells">

						</div>
			</div>


		</div>
	</div>


</body>

</html>
<script type="text/javascript" id="newrank">
{{~it:value:index}}
<div class="weui-cell">
	<div class="weui-cell__hd"><img data-original="{{=value.headimgurl}}" alt="" src="../../image/default.png"  class="pic" style="border-radius:64px; width:64px;"></div>
	<div class="weui-cell__bd"><p>{{=value.real_name}}</p></div>
	<div class="weui-cell__ft">
	{{?value.status=="等待开奖"}}
		<p style="color: orange; font-style: bold;">{{=value.status}}</p>
		{{?}}
		{{?value.status=="中奖"}}
			<p style="color: red; font-style: bold;">{{=value.status}}</p>
			{{?}}

			{{?value.status=="未中奖"}}
				<p style="color: #666; font-style: bold;">{{=value.status}}</p>
				{{?}}
		<div class="detial"><p>{{=value.money}}金豆(押{{=value.code}})</p></div>
	</div>
</div>
{{~}}
</script>
<script type="text/javascript" id="winrank">
{{~it:value:index}}
<div class="weui-cell">
	<div class="weui-cell__hd"><img data-original="{{=value.headimgurl}}" alt="" src="../../image/default.png" class="pic" style="border-radius:64px;  width:64px;"></div>
	<div class="weui-cell__bd"><p>{{=value.real_name}}</p></div>
	<div class="weui-cell__ft">
		<p style="color: red; font-style: bold;">{{=value.money}}豆</p>
		<div class="detial"><p>第{{=index+1}}名</p></div>
	</div>
</div>
{{~}}
</script>

{{~}}
</script>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/weui.min.js"></script>
<script type="text/javascript" src="../../script/wolf.js"></script>
<script type="text/javascript" src="../../script/zepto.min.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript" src="../../script/swiper-3.3.1.min.js"></script>
<script type="text/javascript" src="../../script/dropload.js"></script>
<script type="text/javascript" src="../../script/zepto.picLazyLoad.min.js"></script>
<script>
	var OPENID;

	apiready = function() {
		setTopBar();
		OPENID = api.getPrefs({
			sync: true,
			key: 'openid'
		});
newRank();
nowbean();
	}

	function confirmScore(code,money) {
		api.confirm({
			title: '买定离手',
			msg: '确认下押'+money+'金豆？',
			buttons: ['确定', '取消']
		}, function(ret, err) {
			var index = ret.buttonIndex;
			if(index==1){
				api.ajax({
					url: 'http://www.d-shang.com/index.php?appdice/addtickets',
					method: "post",
					data: {
						values: {
							openid:OPENID,
							code: code,
							money: money
						}
					}
				}, function(ret) {

				api.toast({msg:ret.message});
				newRank();
				nowbean();
				});
			}
		});
	}


//最新排行
function newRank(){
	var loading = weui.loading("拼命加载中...");
api.ajax({
    url: 'http://www.d-shang.com/index.php?appdice/getlastdice/?openid='+OPENID,
    method: 'post',

}, function(ret, err) {
		loading.hide();
    if (ret) {
					var data=ret.data;
		for(var i=0;i<data.length;i++){
				var imgurl = data[i].headimgurl;
				if(imgurl){

					imgurl = imgurl.substring(0, imgurl.length - 1);
					imgurl += '64';
					data[i].headimgurl=imgurl;
				}
				if(data[i].code==1){
					data[i].code="小";
				}else{
						data[i].code="大";
				}
				data[i].money=parseInt(data[i].money);
		}
		var arrText = doT.template($("#newrank").text());
		$(".weui-cells").html(arrText(data));
	$('.pic').picLazyLoad();
    } else {
        api.alert({ msg: JSON.stringify(err) });
    }
});
}

function winRank(){
	var loading = weui.loading("拼命加载中...");
	api.ajax({
	    url: 'http://www.d-shang.com/index.php?appdice/getalldicebystatus/?openid='+OPENID,
	    method: 'post',

	}, function(ret, err) {
			loading.hide();
	    if (ret) {
				var data=ret.data;
				for(var i=0;i<data.length;i++){
				var imgurl = data[i].headimgurl;
				if(imgurl){
				imgurl = imgurl.substring(0, imgurl.length - 1);
				imgurl += '64';
				data[i].headimgurl=imgurl;
				}
				if(data[i].code==1){
				data[i].code="小";
				}else{
					data[i].code="大";
				}
				}


				var arrText = doT.template($("#winrank").text());
				$(".weui-cells").html(arrText(data));
	$('.pic').picLazyLoad();

	    } else {
	        api.alert({ msg: JSON.stringify(err) });
	    }
	});

}
function selfRank(){
	var loading = weui.loading("拼命加载中...");
	api.ajax({
	    url: 'http://www.d-shang.com/index.php?appdice/getalldicebyuid/?openid='+OPENID,
	    method: 'post',
	}, function(ret, err) {
			loading.hide();
	    if (ret) {
				var data=ret.data;

				for(var i=0;i<data.length;i++){
				var imgurl = data[i].headimgurl;
				if(imgurl){
				imgurl = imgurl.substring(0, imgurl.length - 1);
				imgurl += '64';
				data[i].headimgurl=imgurl;
				}
				if(data[i].code==1){
				data[i].code="小";
				}else{
					data[i].code="大";
				}
					data[i].money=parseInt(data[i].money);
				}
				var arrText = doT.template($("#newrank").text());
				$(".weui-cells").html(arrText(data));
				$('.pic').picLazyLoad();

	    } else {
	        api.alert({ msg: JSON.stringify(err) });
	    }
	});
}
function addBorder(obj) {
		var a = $(".select");
		$.each(a, function() {
				$(this).removeClass("checked");
		});
		$(obj).addClass("checked");
}
function nowbean(){
	api.ajax({
		url: 'http://www.d-shang.com/index.php?app/getuserinfo/?openid=' + OPENID
	}, function(ret, err) {
		var user = ret.data;
		var  coupons = parseInt(user.coupons);
		$(".beancount").html(coupons);
	});
}


</script>
