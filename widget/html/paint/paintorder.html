<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>墙面画定制</title>
    <link rel="stylesheet" href="../../css/weui.min.css">
    <link rel="stylesheet" href="../../css/header.css" />
    <style>
        body {
            margin: 0;
            padding: 0px;
            width: 100%;
            background-color: #fff;
        }

        .paintname {
            font-size: 1.2em;
            color: #000;
            margin-left: 15px;
        }

        .nameheader {
            border-bottom: 1px solid #ccc;
        }

        img {
            width: 100%;
            max-height: 350px;
        }

        .paintpic {
            color: #666666;
            margin-top: 70px;
        }

        .paintsize {
            color: #666666;
            font-size: 1em;
            border: 1px dashed #ccc;
            padding: 10px;
            margin: 15px;
            background-color: #f0f0f0;
        }

        .paintprice {
            color: #666666;
            font-size: 1em;
            margin-left: 15px;
        }

        .price {
            color: #ff5b02;
            font-size: 1.2em;
            font-weight: bold;
        }

        .paintcustom {
            color: #666666;
            font-size: 1em;
            margin: 15px;
            margin-bottom: 60px;
        }

        .paintclass {
            color: #c0c0c0;
            font-size: 0.7em;
            margin-left: 15px;
            border: 1px solid #ccc;
            width: auto;
            display: inline-block !important;
            display: inline;
            border-radius: 3px;
        }

        a {
            text-decoration: none;
        }

        .paintsub {
            display: block;
            width: 120px;
            height: 50px;
            background-color: #ff6a05;
            line-height: 50px;
            text-align: center;
            color: #fff;
            font-size: 1em;
            float: right;
        }

        .submitpaint {
            width: 100%;
            position: fixed;
            bottom: 0;
            background-color: #f0f0f0;
        }

        .choosesize {
            border: 1px dashed #ccc;
            margin: 15px;
            color: #666;
        }

        .choosesize a {
            text-decoration: none;
            color: #666;
            display: block;
            margin: 3px;
            font-size: 0.8em;
            width: auto;
            display: inline-block !important;
            display: inline;
            padding: 5px;
        }

        .selected {
            border: 2px solid #ff5b02!important;
            background-color: #ff5b02!important;
            color: #fff!important;
            border-radius: 5px!important;
        }

        .menu {
            text-decoration: none;
            border: 1px solid #ccc;
            display: block;
            margin: 5px;
            border-radius: 5px;
            display: block;
        }

        input {
            font-size: 1em;
        }

        .unit {
            color: #ff5b02;
            font-size: 1em;
        }
    </style>
</head>

<body>
    <header style="position: fixed;" class="page__bd page__bd_spacing">
        <i class="backBtn" ontouchend="goback()"><img src="../../image/back.png" class="back" ></i>
        <span id="title" class="title" style="text-align: center;  margin-right:40px;">墙面画定制</span>
    </header>
    <div class="page_bd content">
        <div class="paintpic"><img src="../../image/defaultimage.png" alt="" class="paintimg"></div>
        <div class="nameheader">
            <div class="paintname">城市剪影-59</div>
            <div class="paintclass">色彩风格：城市剪影</div>
            <div class="paintprice">单价：<span class="unit">￥</span><span class="price">437元/块</span></div>
        </div>



        <div class="paintsize">
            最大尺寸：
            <p>双层铝墙板 波西米亚粗麻纹：单块最高3米，宽0.55米</p>
            <p>木塑板 波西米亚粗麻纹：单块最高3米，宽度0.6米</p>
            <p>木塑板 波西米亚粗麻纹：单块最高2.6米，宽度0.6米</p>
        </div>

        <div class="choosesize">
            定制框体： <br>
            <a href="javascript:;" class="menu selected" sku="109965" onclick="addborder(this)" width="3" price="437">3米 双层铝墙板 波西米亚粗麻纹</a>
            <a href="javascript:;" class="menu" sku="10996" onclick="addborder(this)" width="3" price="380">3米 木塑板 波西米亚粗麻纹</a>
            <a href="javascript:;" class="menu" sku="110574" onclick="addborder(this)" width="2.6" price="330">2.6米 木塑板 波西米亚粗麻纹</a>
        </div>
        <div class="paintcustom">
            定制尺寸<br>
            <span>高&nbsp;&nbsp;<input type="text"  style="width:100px "; placeholder="单位是米" class="custom" id="height"></in></span>&nbsp;&nbsp;*&nbsp;&nbsp;
            <span>宽&nbsp;&nbsp;<input type="text" style="width:100px; " placeholder="单位是米" class="custom" id="width"></in></span>
        </div>
        <div class="submitpaint">
            <a href="javascript:;" class="paintsub" onclick="message()">提交定制</a>
        </div>
        <input type="hidden" name="token" id="token" value="170731131523YANO">
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script src="../../script/zepto.min.js"></script>
<script src="../../script/wolf.js"></script>
<script src="../../script/doT.min.js"></script>
<script src="../../script/weui.min.js"></script>
<script type="text/javascript">
    apiready = function() {
        setTopBar();
        var title = api.pageParam.title;
        var pic = api.pageParam.pic;
        var category_name = api.pageParam.category_name;
        //获取openid
        OPENID = api.getPrefs({
            sync: true,
            key: 'openid'
        });
        $('.paintname').html(title);
        var some_url = 'http://www.dszpvip.com/' + pic;
        $(".paintimg").attr("src", some_url);
        $('.paintclass').html(category_name);

    }

    function addborder(obj) {
        var a = $(".menu");
        $.each(a, function() {
            $(this).removeClass("selected");
        });
        $(obj).addClass("selected");
        var price = $(".selected").attr("price");
        $('.price').html(price + '元/块');
    }

    function message() {
        //首先获取选中的a标签的数字，名称
        var name = $(".selected").text();
        var widthsize = $(".selected").attr("width");
        var price = $(".selected").attr("price");
        //然后获取输入框的数字
        var height = Math.floor($("#height").val() * 100) / 100;
        var width = Math.floor($("#width").val() * 100) / 100;
        $("#height").val(height);
        $("#width").val(width);
        //进行判断
        //判断高度不能大于3米，宽不限。
        $("#height").val(height);
        if (parseFloat(height) > parseFloat("3.00")) {
            api.alert({
                msg: "超出最大尺寸"
            });
            $("#height").val("");
            return;
        }
        $("#width").val(width);
        if (height == 0 || width == 0) {
            api.alert({
                msg: "请输入尺寸"
            });
            $("#height").val("");
            $("#width").val("");
            return;
        }
        if (parseFloat(height) < parseFloat("0") || parseFloat(width) < parseFloat("0")) {
            api.alert({
                msg: "请输入正确的尺寸"
            });
            return;
        }
        var num = Math.ceil(FloatDiv(width, widthsize)); //向上四舍五入
        var sum = price * num;
        var str = "名称：" + name + "\n数量：" + num + "块\n" + "单价：￥" + price + "元\n规格：长 " + height + "米， 宽 " + width + "米\n总计：￥" + sum + "元\n";
        api.confirm({
            title: '请确认价格',
            msg: str,
            buttons: ['取消', '提交订单']
        }, function(ret) {
            //提交成功后
            if(ret.buttonIndex==2){
              subOrder(height, num, width);
            }
        });
    }
    //浮点数除法运算
    function FloatDiv(arg1, arg2) {
        var t1 = 0,
            t2 = 0,
            r1, r2;
        try {
            t1 = arg1.toString().split(".")[1].length
        } catch (e) {}
        try {
            t2 = arg2.toString().split(".")[1].length
        } catch (e) {}
        with(Math) {
            r1 = Number(arg1.toString().replace(".", ""));
            r2 = Number(arg2.toString().replace(".", ""));
            return (r1 / r2) * pow(10, t2 - t1);
        }
    }
    //提交订单
    function subOrder(height, num, width) {
        //获取选中的sku：编号
        var sku = $(".selected").attr("sku");
        //获取token的值
        var token = $("#token").val();
        //获取选中的商品名
        var remark = $(".paintname").text();
        //备注产品名+高度+宽度
        remark += "/高度：" + height + "/宽度：" + width;



        var url = 'http://www.d-shang.com/index.php?appbuy/addpaintorder/?openid=' + OPENID;


        api.ajax({
            url: url,
            method: 'post',
            data: {
                values: {
                    token: token,
                    sku: sku,
                    num: num,
                    remark: remark
                }
            }
        }, function(ret, err) {
                api.alert({
                    msg: ret.message
                });


        });


    }
</script>

</html>
